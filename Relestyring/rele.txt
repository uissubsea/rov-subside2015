#include <stm32f10x_conf.h>
#include <stm32f10x.h>
#include <time.h>
#include <Delay.h>


void RCC_Configuration(void){
  RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM3, ENABLE);

  RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA | RCC_APB2Periph_GPIOB | RCC_APB2Periph_GPIOC | RCC_APB2Periph_AFIO, ENABLE);
}


int main(void)
{

	GPIO_InitTypeDef gpioStruct;

	gpioStruct.GPIO_Mode = GPIO_Mode_Out_PP;
	gpioStruct.GPIO_Pin = GPIO_Pin_8 | GPIO_Pin_9 | GPIO_Pin_10;

	GPIO_Init(GPIOC, &gpioStruct);
	GPIO_WriteBit(GPIOC, GPIO_Pin_8 | GPIO_Pin_9 | GPIO_Pin_10, Bit_SET);

	while(1)
    {

		/* Pin_x = 0 betyr at kretsen er åpen. Pin_x = 1 betyr at kretsen er lukket */
		/* Ingen strøm på ROV */
    	GPIO_Pin_8 = 0; /* Isolering */
    	GPIO_Pin_9 = 0; /* Oppladning */
    	GPIO_Pin_10 = 0; /* Utladning */

    	Delay_ms(500);
    	/* Lader opp kondensatorer */
    		GPIO_Pin_9 = 1;
    		Delay_ms(500);

    	/* ROV kjører */
    	GPIO_Pin_8 = 1;
    	GPIO_Pin_9 = 0;


    	/* Lader ut */
    	if(spennings_maaler < 10 & GPIO_Pin_8 = 1 & GPIO_Pin_9 = 0 & GPIO_Pin_10 = 0) {
    		Delay_ms(200);
    		GPIO_Pin_10 = 1;
    	}
    	/* Utladet*/
    	Delay_ms(5000);
    	GPIO_Pin_10 = 0;
    }
}
